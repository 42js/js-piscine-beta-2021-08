name: ë¦¬ë·°ì–´ ë§¤ì¹­

on:
  workflow_dispatch:
    inputs:
      subject:
        description: ìë™ìœ¼ë¡œ ë§¤ì¹­ ì‹œí‚¬ íƒ€ê²Ÿ Subject
        required: true
      currect-label:
        description: ì •ìƒì ì¸ ì œì¶œ í™•ì¸ìš© ë¼ë²¨
        required: true
        default: "âœ… ì •ìƒì ì¸ ì œì¶œ"
      reviewer:
        description: ë¦¬ë·°ì–´ë¡œ ì§€ì •ë  íŒ€ëª…
        required: true
        default: "beta-pisciner"

jobs:
  matching-reviwers:
    name: "í•´ë‹¹ ì„œë¸Œì íŠ¸ Reviewer ë§¤ì¹­"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.SECRET_PAT }}
          script: |
            const prlistConfig = github.pulls.list.endpoint.merge({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });
            const prList = await github.paginate(prlistConfig);
            for (const pr of prList) {
              if (
                pr.state === "open" &&
                !!pr.labels.find(
                  (label) => label.name === "${{ github.event.inputs.subject }}"
                )
              ) {
                if (
                  !!pr.labels.find(
                    (label) => label.name === "${{ github.event.inputs.currect-label }}"
                  )
                ) {
                  await github.pulls.requestReviewers({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    pull_number: pr.number,
                    team_reviewers: ["${{ github.event.inputs.reviewer }}"],
                  });
                  await github.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: pr.number,
                    body: [
                      `ğŸ‰ í‰ê°€ ë§¤ì¹­ì´ ë˜ì…¨ìŠµë‹ˆë‹¤! ë¦¬ë·°ì–´ë¥¼ í™•ì¸í›„ ì•„ë˜ì˜ ì£¼ì˜ ì‚¬í•­ì„ í™•ì¸í•˜ì—¬ ì§„í–‰ í•´ì£¼ì„¸ìš”!`,
                      `- âš ï¸ í‰ê°€ì‹œ ì£¼ì˜ ì‚¬í•­`,
                      `  - ë³¸ê³¼ì •ê³¼ ë™ì¼ í•˜ê²Œ ìœ„ì—ì„œ í‹€ë¦° ê²½ìš° ê·¸ ì¦‰ì‹œ í‰ê°€ì ìˆ˜ ë¶€ì—¬ëŠ” ë©ˆì¶°ì•¼ í•©ë‹ˆë‹¤.`,
                      `  - í‰ê°€ë¥¼ ì§„í–‰ í• ë•Œ PRì˜ CodeReview ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ \`approve\`ë¡œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.`,
                      `  - \`comment\` ë¡œ ì‘ì„±í•˜ì—¬ ë‚¨ê²¨ì£¼ì‹œë©´ ìŠ¤íƒ­ë¶„ë“¤ì´ í™•ì¸í•˜ëŠ”ë° ì–´ë ¤ì›€ì„ ê²©ìŠµë‹ˆë‹¤ ã… ã… `,
                      `  - PR ë¦¬ë·°ì— êµ¬ê¸€ í¼ ì œì¶œ í›„ ë‚˜ì˜¤ëŠ” ì ìˆ˜ ê²°ê³¼ë¥¼ ê¼­ ê°™ì´ ì œì¶œ í•˜ì—¬ì£¼ì„¸ìš”!`,
                    ].join("\n"),
                  });
                } else if (
                  !!pr.labels.find(
                    (label) => label.name === "${{ github.event.inputs.wrong-label }}"
                  )
                ) {
                  await github.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: pr.number,
                    body: [
                      `ğŸ˜­ ì•ˆíƒ€ê¹ì§€ë§Œ ì œì¶œ ê¸°ê°„ë‚´ì— ì •ìƒì ìœ¼ë¡œ ì œì¶œì´ ë˜ì§€ ì•Šì•„ì„œ 0ì ìœ¼ë¡œ ì²˜ë¦¬ ë©ë‹ˆë‹¤.`,
                      `- ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” \`#team_qna\` ì— ë¬¸ì˜ í•´ì£¼ì„¸ìš”!`,
                      `- ë§Œì•½ ë¦¬ë·°ë¥¼ ë°›ê³  ì‹¶ì€ ê²½ìš° ì£¼ë³€ ë™ë£Œ ë¶„ë“¤ê»˜ ê°œì¸ì ìœ¼ë¡œ ë¦¬ë·°ë¥¼ ìš”ì²­í•´ì„œ ì§„í–‰í•˜ì—¬ ì£¼ì„¸ìš”!`,
                    ].join("\n"),
                  });
                  await github.pulls.update({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    pull_number: pr.number,
                    state: "closed",
                  });
                }
              }
            }
