name: ë¦¬ë·°ì–´ ë§¤ì¹­

on:
  workflow_dispatch:
    inputs:
      subject:
        description: ìë™ìœ¼ë¡œ ë§¤ì¹­ ì‹œí‚¬ íƒ€ê²Ÿ Subject
        required: true
      currect-label:
        description: ì •ìƒì ì¸ ì œì¶œ í™•ì¸ìš© ë¼ë²¨
        required: true
        default: "âœ… ì •ìƒì ì¸ ì œì¶œ"
      reviewer:
        description: ë¦¬ë·°ì–´ë¡œ ì§€ì •ë  íŒ€ëª…
        required: true
        default: "piscine"

jobs:
  matching-reviwers:
    name: "í•´ë‹¹ ì„œë¸Œì íŠ¸ Reviewer ë§¤ì¹­"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v4
        with:
          github-token: ${{ secrets.SECRET_PAT }}
          script: |
            const prlistConfig = github.pulls.list.endpoint.merge({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });

            const prList = await github.paginate(prlistConfig);

            for (const pr of prList) {
              if (
                pr.state === "open" &&
                !!pr.labels.find(
                  (label) => label.name === "${{ github.event.inputs.subject }}"
                ) &&
                !!pr.labels.find(
                  (label) => label.name === "${{ github.event.inputs.currect-label }}"
                )
              ) {
                await github.pulls.requestReviewers({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  pull_number: pr.number,
                  team_reviewers: ["${{ github.event.inputs.reviewer }}"],
                });
                await github.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: pr.number,
                  body : [
                    !!pr.user && `ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”! ${pr.user.login}ë‹˜!`,
                    `- ğŸ‰ í‰ê°€ ë§¤ì¹­ì´ ë˜ì…¨ìŠµë‹ˆë‹¤! ë¦¬ë·°ì–´ë¥¼ í™•ì¸í›„ ì•„ë˜ì˜ ì£¼ì˜ ì‚¬í•­ì„ í™•ì¸í•˜ì—¬ ì§„í–‰ í•´ì£¼ì„¸ìš”!`,
                    `- âš ï¸ í‰ê°€ì‹œ ì£¼ì˜ ì‚¬í•­`,
                    `  - ë³¸ê³¼ì •ê³¼ ë™ì¼ í•˜ê²Œ ìœ„ì—ì„œ í‹€ë¦° ê²½ìš° ê·¸ ì¦‰ì‹œ í‰ê°€ì ìˆ˜ ë¶€ì—¬ëŠ” ë©ˆì¶°ì•¼ í•©ë‹ˆë‹¤.`
                    `  - í‰ê°€ë¥¼ ì§„í–‰ í• ë•Œ PRì˜ CodeReview ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ `approve`ë¡œ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”.`,
                    `  - `comment` ë¡œ ì‘ì„±í•˜ì—¬ ë‚¨ê²¨ì£¼ì‹œë©´ ìŠ¤íƒ­ë¶„ë“¤ì´ í™•ì¸í•˜ëŠ”ë° ì–´ë ¤ì›€ì„ ê²©ìŠµë‹ˆë‹¤ ã… ã… `,
                    `  - PR ë¦¬ë·°ì— êµ¬ê¸€ í¼ ì œì¶œ í›„ ë‚˜ì˜¤ëŠ” ì ìˆ˜ ê²°ê³¼ë¥¼ ê¼­ ê°™ì´ ì œì¶œ í•˜ì—¬ì£¼ì„¸ìš”!`,
                  ].join("\n"),
                });
              }
            }
